<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Meu Primeiro Jogo da Cobrinha</title>

   <style>
      #screen {
         border: 1px solid #CCC;
         background-color: #9BC405;
         image-rendering: pixelated;
         image-rendering: crisp-edges;
         image-rendering: -moz-crisp-edges;
         width: 40px;
         height: 40px;
      }
   </style>


</head>

<body>
   <canvas id="screen" width="10px" height="10px"></canvas>
   <script>

      const screen = document.getElementById('screen');
      const context = screen.getContext('2d');

      function createGame() {

         const state = {
            snake: [
               { x: 5, y: 5 },
               { x: 4, y: 5 }
            ],
            fruit: { x: 4, y: 3 },
            direction: 'right'
         };

         function moveSnake(command) {

            const keyPressed = command.keyPressed;

            if (keyPressed === 'ArrowUp' && state.direction !== 'down') {
               state.direction = 'up';
               return;
            }

            if (keyPressed === 'ArrowDown' && state.direction !== 'up') {
               state.direction = 'down';
               return;
            }

            if (keyPressed === 'ArrowLeft' && state.direction !== 'right') {
               state.direction = 'left';
               return;
            }

            if (keyPressed === 'ArrowRight' && state.direction !== 'left') {
               state.direction = 'right';
               return;
            }

         }

         function handleDriveSnake() {

            let snakeX = state.snake[0].x;
            let snakeY = state.snake[0].y;

            if (state.direction === 'right') {
               snakeX = snakeX + 1;
            }

            if (state.direction === 'left') {
               snakeX = snakeX - 1;
            }

            if (state.direction === 'up') {
               snakeY = snakeY - 1;
            }

            if (state.direction === 'down') {
               snakeY = snakeY + 1;
            }


            state.snake.pop();
            state.snake.unshift({ x: snakeX, y: snakeY });
         }


         return { state, moveSnake, handleDriveSnake }
      }

      const game = createGame();

      document.addEventListener('keydown', handleKeydown);

      function handleKeydown(event) {
         const keyPressed = event.key;

         const command = {
            keyPressed
         }

         game.moveSnake(command);

      }

      function renderSnakeAndFruit() {
         for (const index in game.state.snake) {
            context.fillStyle = 'black';
            context.fillRect(game.state.snake[index].x, game.state.snake[index].y, 1, 1);
         }

         context.fillStyle = 'red';
         context.fillRect(game.state.fruit.x, game.state.fruit.y, 1, 1);
      }


      function startGame() {
         
         // Limpa a tela do jogo
         context.fillStyle = '#9BC405';
         context.clearRect(0, 0, 10, 10);

         if (game.state.snake[0].x > 9 && game.state.direction === 'right' || game.state.snake[0].x > 9 && game.state.direction === 'up' || game.state.snake[0].x > 9 && game.state.direction === 'down') {
            game.state.snake[0].x = 0;
         }

         if (game.state.snake[0].y > 9 && game.state.direction === 'down' || game.state.snake[0].y > 9 && game.state.direction === 'right' || game.state.snake[0].y > 9 && game.state.direction === 'left') {
            game.state.snake[0].y = 0;
         }

         if (game.state.snake[0].x < 0 && game.state.direction === 'left' || game.state.snake[0].x < 0 && game.state.direction === 'up' || game.state.snake[0].x < 0 && game.state.direction === 'down') {
            game.state.snake[0].x = 10;
         }

         if (game.state.snake[0].y < 0 && game.state.direction === 'up' || game.state.snake[0].y < 0 && game.state.direction === 'right' || game.state.snake[0].y < 0 && game.state.direction === 'left') {
            game.state.snake[0].y = 10;
         }

         renderSnakeAndFruit();

         game.handleDriveSnake();

      }

      setInterval(startGame, 100);

   </script>

</body>

</html>